// ============================================================================
// RCLONE MANAGER - LIBADWAITA + ANGULAR MATERIAL THEME
// ============================================================================
// This theme bridges GNOME libadwaita CSS variables with Angular Material M3.
//
// Structure:
//   1. GNOME Palette - Official GNOME HIG colors (single source of truth)
//   2. Libadwaita Semantic - Theme-aware UI colors (light/dark)
//   3. Angular Material Bridge - Maps libadwaita → --mat-sys-* variables
//   4. Legacy Aliases - Backward compatibility with existing components
// ============================================================================

@use '@angular/material' as mat;
@use 'sass:map';
@use 'sass:color';
@use 'animations';

// ============================================================================
// SECTION 1: GNOME COLOR PALETTE (Single Source of Truth)
// ============================================================================
// Official GNOME HIG colors: https://developer.gnome.org/hig/reference/palette.html
// These never change between light/dark - they are the raw color values.

:root {
  // Blue
  --gnome-blue-1: #99c1f1;
  --gnome-blue-2: #62a0ea;
  --gnome-blue-3: #3584e4;
  --gnome-blue-4: #1c71d8;
  --gnome-blue-5: #1a5fb4;

  // Green
  --gnome-green-1: #8ff0a4;
  --gnome-green-2: #57e389;
  --gnome-green-3: #33d17a;
  --gnome-green-4: #2ec27e;
  --gnome-green-5: #26a269;

  // Yellow
  --gnome-yellow-1: #f9f06b;
  --gnome-yellow-2: #f8e45c;
  --gnome-yellow-3: #f6d32d;
  --gnome-yellow-4: #f5c211;
  --gnome-yellow-5: #e5a50a;

  // Orange
  --gnome-orange-1: #ffbe6f;
  --gnome-orange-2: #ffa348;
  --gnome-orange-3: #ff7800;
  --gnome-orange-4: #e66100;
  --gnome-orange-5: #c64600;

  // Red
  --gnome-red-1: #f66151;
  --gnome-red-2: #ed333b;
  --gnome-red-3: #e01b24;
  --gnome-red-4: #c01c28;
  --gnome-red-5: #a51d2d;

  // Purple
  --gnome-purple-1: #dc8add;
  --gnome-purple-2: #c061cb;
  --gnome-purple-3: #9141ac;
  --gnome-purple-4: #813d9c;
  --gnome-purple-5: #613583;

  // Neutrals - Light
  --gnome-light-1: #ffffff;
  --gnome-light-2: #f6f5f4;
  --gnome-light-3: #deddda;
  --gnome-light-4: #c0bfbc;
  --gnome-light-5: #9a9996;

  // Neutrals - Dark
  --gnome-dark-1: #77767b;
  --gnome-dark-2: #5e5c64;
  --gnome-dark-3: #3d3846;
  --gnome-dark-4: #241f31;
  --gnome-dark-5: #000000;
}

// ============================================================================
// SECTION 2: LIBADWAITA SEMANTIC VARIABLES (Light/Dark Mode)
// ============================================================================
// Based on: https://gnome.pages.gitlab.gnome.org/libadwaita/doc/1.2/css-variables.html
// These change between light and dark themes.

:root,
.light {
  color-scheme: light;

  // Window Colors
  --window-bg-color: #fafafb;
  --window-fg-color: rgba(0, 0, 6, 0.8);

  // Banner Colors
  --banner-bg-color: #d4d4d7;

  // View Colors (content areas)
  --view-bg-color: #ffffff;
  --view-fg-color: var(--window-fg-color);

  // Headerbar Colors
  --headerbar-bg-color: #ffffff;
  --headerbar-fg-color: var(--window-fg-color);
  --headerbar-shade-color: rgba(0, 0, 0, 0.12);

  // Sidebar Colors
  --sidebar-bg-color: #ebebed;
  --sidebar-fg-color: var(--window-fg-color);

  // Card Colors
  --card-bg-color: #ffffff;
  --card-fg-color: var(--window-fg-color);
  --card-shade-color: rgba(0, 0, 6, 0.07);

  // Popover/Menu Colors
  --popover-bg-color: #ffffff;
  --popover-fg-color: var(--window-fg-color);

  // Accent Colors (Primary action color - Blue)
  --accent-bg-color: var(--gnome-blue-3);
  --accent-fg-color: #ffffff;
  --accent-color: var(--gnome-blue-4); // Standalone (darker for light mode)

  // Success Colors (Green)
  --success-bg-color: var(--gnome-green-4);
  --success-fg-color: #ffffff;
  --success-color: var(--gnome-green-5);

  // Warning Colors (Yellow)
  --warning-bg-color: var(--gnome-yellow-5);
  --warning-fg-color: rgba(0, 0, 0, 0.8);
  --warning-color: var(--gnome-yellow-5);

  // Destructive/Error Colors (Red)
  --destructive-bg-color: var(--gnome-red-3);
  --destructive-fg-color: #ffffff;
  --destructive-color: var(--gnome-red-4);

  // Interaction Colors (using color-mix for theme-aware opacity)
  --border-color: color-mix(in srgb, currentColor 15%, transparent);
  --hover-bg-color: rgba(var(--window-fg-color-rgb), 0.07);
  --active-bg-color: color-mix(in srgb, currentColor 16%, transparent);
  --selected-bg-color: color-mix(in srgb, currentColor 10%, transparent);

  // Dim/Muted
  --dim-color: color-mix(in srgb, var(--window-fg-color) 55%, transparent);

  // Shadows
  --shadow-color: rgba(0, 0, 0, 0.08);

  // RGB Variants (for rgba() usage)
  --window-bg-color-rgb: 250, 250, 251;
  --window-fg-color-rgb: 0, 0, 6;
  --view-bg-color-rgb: 255, 255, 255;
  --sidebar-bg-color-rgb: 235, 235, 237;
  --dim-color-rgb: 147, 144, 144;
}

.dark {
  color-scheme: dark;

  // Window Colors
  --window-bg-color: #222226;
  --window-fg-color: #ffffff;

  // Banner Colors
  --banner-bg-color: #3d3d42;

  // View Colors
  --view-bg-color: #1e1e1e;
  --view-fg-color: var(--window-fg-color);

  // Headerbar Colors
  --headerbar-bg-color: #2e2e32;
  --headerbar-fg-color: var(--window-fg-color);
  --headerbar-shade-color: rgba(0, 0, 0, 0.9);

  // Sidebar Colors
  --sidebar-bg-color: #2e2e32;
  --sidebar-fg-color: var(--window-fg-color);

  // Card Colors
  --card-bg-color: rgba(255, 255, 255, 0.08);
  --card-fg-color: var(--window-fg-color);
  --card-shade-color: rgba(0, 0, 6, 0.36);

  // Popover/Menu Colors
  --popover-bg-color: #36363a;
  --popover-fg-color: var(--window-fg-color);

  // Accent Colors (lighter for dark mode)
  --accent-bg-color: var(--gnome-blue-3);
  --accent-fg-color: #ffffff;
  --accent-color: var(--gnome-blue-1);

  // Success Colors
  --success-bg-color: var(--gnome-green-5);
  --success-fg-color: #ffffff;
  --success-color: var(--gnome-green-1);

  // Warning Colors
  --warning-bg-color: #cd9309;
  --warning-fg-color: rgba(0, 0, 0, 0.8);
  --warning-color: var(--gnome-yellow-1);

  // Destructive/Error Colors
  --destructive-bg-color: var(--gnome-red-4);
  --destructive-fg-color: #ffffff;
  --destructive-color: var(--gnome-red-1);

  // Interaction Colors
  --border-color: color-mix(in srgb, currentColor 15%, transparent);
  --hover-bg-color: rgba(var(--window-fg-color-rgb), 0.07);
  --active-bg-color: color-mix(in srgb, currentColor 16%, transparent);
  --selected-bg-color: color-mix(in srgb, currentColor 10%, transparent);

  // Dim/Muted
  --dim-color: color-mix(in srgb, var(--window-fg-color) 55%, transparent);

  // Shadows
  --shadow-color: rgba(0, 0, 0, 0.3);

  // RGB Variants (for rgba() usage)
  --window-bg-color-rgb: 34, 34, 38;
  --window-fg-color-rgb: 255, 255, 255;
  --view-bg-color-rgb: 30, 30, 30;
  --sidebar-bg-color-rgb: 46, 46, 50;
  --dim-color-rgb: 147, 144, 144;
}

// ============================================================================
// SECTION 3: ANGULAR MATERIAL M3 THEME BRIDGE
// ============================================================================
// Maps libadwaita semantic variables to Angular Material's --mat-sys-* system.
// This allows Material components to automatically use libadwaita colors.

// Angular Material Theme Definition (using GNOME colors for M3 palettes)
$gnome-green-palette: (
  0: #0d3d24,
  10: #167345,
  20: #1e8a57,
  25: #228f5c,
  30: #26a269,
  35: #2ab670,
  40: #2ec27e,
  50: #33d17a,
  60: #57e389,
  70: #8ff0a4,
  80: #b8f0c8,
  90: #d8f5e0,
  95: #ecfaee,
  99: #f8fdf9,
  100: #ffffff,
  secondary: (
    0: #103b6c,
    10: #103b6c,
    20: #154d90,
    30: #1a5fb4,
    40: #1c71d8,
    50: #3584e4,
    60: #62a0ea,
    70: #99c1f1,
    80: #b8d9ff,
    90: #d8ebff,
    95: #f0f7ff,
    99: #f8fbff,
    100: #ffffff,
  ),
  neutral: (
    0: #000000,
    10: #1a1a1a,
    17: #2a2a2a,
    20: #313030,
    22: #353434,
    24: #3a3939,
    25: #3c3b3b,
    30: #474646,
    35: #535252,
    40: #5f5e5e,
    50: #787776,
    60: #929090,
    70: #adabaa,
    80: #c9c6c5,
    87: #ddd9d9,
    90: #e5e2e1,
    92: #ebe7e7,
    94: #f0eded,
    95: #f4f0ef,
    96: #f6f3f2,
    98: #faf8f7,
    99: #fcfbfa,
    100: #ffffff,
  ),
  neutral-variant: (
    0: #000000,
    10: #181c1d,
    20: #2d3132,
    25: #383c3d,
    30: #434748,
    35: #4f5354,
    40: #5b5f60,
    50: #747878,
    60: #8e9192,
    70: #a8acac,
    80: #c4c7c8,
    90: #e0e3e4,
    95: #eef1f2,
    98: #f7fafa,
    99: #fafdfd,
    100: #ffffff,
  ),
  error: (
    0: #700e17,
    10: #700e17,
    20: #8b1522,
    30: #a51d2d,
    40: #c01c28,
    50: #e01b24,
    60: #ed333b,
    70: #f66151,
    80: #faa7a0,
    90: #ffcdd2,
    95: #ffebee,
    99: #fffbfb,
    100: #ffffff,
  ),
);

$light-theme: (
  color: (
    theme-type: light,
    primary: $gnome-green-palette,
    tertiary: map.get($gnome-green-palette, secondary),
  ),
);

$dark-theme: (
  color: (
    theme-type: dark,
    primary: $gnome-green-palette,
    tertiary: map.get($gnome-green-palette, secondary),
  ),
);

// Apply Material themes with Libadwaita surface overrides
:root,
.light {
  @include mat.theme($light-theme);

  // ===== MATERIAL M3 SURFACE OVERRIDES =====
  // Force Material to use pure libadwaita neutrals instead of tinted surfaces

  // Surface colors (backgrounds)
  --mat-sys-background: var(--window-bg-color);
  --mat-sys-surface: var(--window-bg-color);
  --mat-sys-surface-bright: var(--view-bg-color);
  --mat-sys-surface-dim: var(--sidebar-bg-color);
  --mat-sys-surface-container: var(--view-bg-color);
  --mat-sys-surface-container-low: var(--sidebar-bg-color);
  --mat-sys-surface-container-lowest: var(--view-bg-color);
  --mat-sys-surface-container-high: var(--card-bg-color);
  --mat-sys-surface-container-highest: var(--card-bg-color);
  --mat-sys-surface-variant: var(--sidebar-bg-color);

  // On-surface colors (text on backgrounds)
  --mat-sys-on-background: var(--window-fg-color);
  --mat-sys-on-surface: var(--window-fg-color);
  --mat-sys-on-surface-variant: var(--window-fg-color);

  // Outline colors (borders)
  --mat-sys-outline: var(--border-color);
  --mat-sys-outline-variant: var(--border-color);

  // Inverse colors (for snackbars, tooltips)
  --mat-sys-inverse-surface: #2e2e32;
  --mat-sys-inverse-on-surface: #ffffff;
  --mat-sys-inverse-primary: var(--gnome-green-1);

  // Scrim/shadow
  --mat-sys-scrim: rgba(0, 0, 0, 0.3);
  --mat-sys-shadow: rgba(0, 0, 0, 0.15);

  // Primary overrides (keep green for buttons/actions)
  --mat-sys-primary: var(--gnome-green-4);
  --mat-sys-on-primary: #ffffff;
  --mat-sys-primary-container: color-mix(in srgb, var(--gnome-green-4) 15%, var(--view-bg-color));
  --mat-sys-on-primary-container: var(--gnome-green-5);

  // Secondary (neutral for less emphasis)
  --mat-sys-secondary: var(--dim-color);
  --mat-sys-on-secondary: #ffffff;
  --mat-sys-secondary-container: var(--sidebar-bg-color);
  --mat-sys-on-secondary-container: var(--window-fg-color);

  // Tertiary (accent blue)
  --mat-sys-tertiary: var(--gnome-blue-3);
  --mat-sys-on-tertiary: #ffffff;
  --mat-sys-tertiary-container: color-mix(in srgb, var(--gnome-blue-3) 15%, var(--view-bg-color));
  --mat-sys-on-tertiary-container: var(--gnome-blue-5);

  // Error colors
  --mat-sys-error: var(--gnome-red-3);
  --mat-sys-on-error: #ffffff;
  --mat-sys-error-container: color-mix(in srgb, var(--gnome-red-3) 15%, var(--view-bg-color));
  --mat-sys-on-error-container: var(--gnome-red-5);
}

.dark {
  @include mat.theme($dark-theme);

  // ===== MATERIAL M3 SURFACE OVERRIDES =====
  // Force Material to use pure libadwaita neutrals instead of tinted surfaces

  // Surface colors (backgrounds)
  --mat-sys-background: var(--window-bg-color);
  --mat-sys-surface: var(--window-bg-color);
  --mat-sys-surface-bright: var(--popover-bg-color);
  --mat-sys-surface-dim: var(--view-bg-color);
  --mat-sys-surface-container: var(--view-bg-color);
  --mat-sys-surface-container-low: var(--view-bg-color);
  --mat-sys-surface-container-lowest: var(--view-bg-color);
  --mat-sys-surface-container-high: var(--sidebar-bg-color);
  --mat-sys-surface-container-highest: var(--popover-bg-color);
  --mat-sys-surface-variant: var(--sidebar-bg-color);

  // On-surface colors (text on backgrounds)
  --mat-sys-on-background: var(--window-fg-color);
  --mat-sys-on-surface: var(--window-fg-color);
  --mat-sys-on-surface-variant: var(--window-fg-color);

  // Outline colors (borders)
  --mat-sys-outline: var(--border-color);
  --mat-sys-outline-variant: var(--border-color);

  // Inverse colors (for snackbars, tooltips)
  --mat-sys-inverse-surface: #fafafb;
  --mat-sys-inverse-on-surface: rgba(0, 0, 6, 0.8);
  --mat-sys-inverse-primary: var(--gnome-green-4);

  // Scrim/shadow
  --mat-sys-scrim: rgba(0, 0, 0, 0.5);
  --mat-sys-shadow: rgba(0, 0, 0, 0.3);

  // Primary overrides (keep green for buttons/actions)
  --mat-sys-primary: var(--gnome-green-4);
  --mat-sys-on-primary: #ffffff;
  --mat-sys-primary-container: color-mix(in srgb, var(--gnome-green-4) 20%, var(--view-bg-color));
  --mat-sys-on-primary-container: var(--gnome-green-1);

  // Secondary (neutral for less emphasis)
  --mat-sys-secondary: var(--dim-color);
  --mat-sys-on-secondary: #ffffff;
  --mat-sys-secondary-container: var(--sidebar-bg-color);
  --mat-sys-on-secondary-container: var(--window-fg-color);

  // Tertiary (accent blue)
  --mat-sys-tertiary: var(--gnome-blue-3);
  --mat-sys-on-tertiary: #ffffff;
  --mat-sys-tertiary-container: color-mix(in srgb, var(--gnome-blue-3) 20%, var(--view-bg-color));
  --mat-sys-on-tertiary-container: var(--gnome-blue-1);

  // Error colors
  --mat-sys-error: var(--gnome-red-3);
  --mat-sys-on-error: #ffffff;
  --mat-sys-error-container: color-mix(in srgb, var(--gnome-red-3) 20%, var(--view-bg-color));
  --mat-sys-on-error-container: var(--gnome-red-1);
}

// ============================================================================
// SECTION 4: SEMANTIC COLORS & DESIGN SYSTEM TOKENS
// ============================================================================
// App-specific semantic colors and design system tokens.

:root {
  // ===== SEMANTIC COLOR ALIASES =====
  // These map to the GNOME palette for app-specific semantic meaning

  --primary-color: var(--gnome-green-4);
  --accent-color: var(--gnome-blue-3);
  --warn-color: var(--gnome-red-3);
  --orange: var(--gnome-orange-3);
  --yellow: var(--gnome-yellow-3);
  --purple: var(--gnome-purple-3);
  --red: var(--gnome-red-3);

  // Light color variants
  --light-green: var(--gnome-green-1);
  --light-blue: var(--gnome-blue-1);
  --light-orange: var(--gnome-orange-1);
  --light-purple: var(--gnome-purple-1);
  --light-yellow: var(--gnome-yellow-1);

  // RGB variants for semantic colors (for rgba() usage)
  --accent-color-rgb: 53, 132, 228;
  --warn-color-rgb: 224, 27, 36;
  --primary-color-rgb: 46, 194, 126;
  --purple-rgb: 145, 65, 172;
  --orange-rgb: 255, 120, 0;
  --yellow-rgb: 246, 211, 45;
  --red-rgb: 224, 27, 36;

  // UI composition variables (libadwaita style - outlines instead of shadows)
  --box-shadow: 0 0 0 1px var(--card-shade-color);
  --shade-color: rgba(0, 0, 6, 0.07);

  // ===== DESIGN SYSTEM TOKENS =====

  // Spacing Scale
  --space-xxs: 0.25rem;
  --space-xs: 0.5rem;
  --space-sm: 0.75rem;
  --space-md: 1rem;
  --space-lg: 1.25rem;
  --space-xl: 1.5rem;
  --space-2xl: 2rem;

  // Border Radius Scale
  --radius-xxs: 0.25rem;
  --radius-xs: 0.5rem;
  --radius-sm: 0.75rem;
  --radius-md: 1rem;
  --radius-lg: 1.5rem;

  // Component-specific radius aliases
  --border-radius: var(--radius-xs);
  --button-border-radius: var(--radius-sm);
  --input-border-radius: var(--radius-md);
  --card-border-radius: var(--radius-sm);
  --panel-radius: var(--radius-sm);
  --modal-radius: var(--radius-md);
  --app-border-radius: var(--radius-md);
  --icon-radius: var(--radius-md);
  --item-radius: var(--radius-sm);
  --badge-radius: var(--radius-sm);
  --status-radius: var(--radius-sm);
  --usage-bar-radius: var(--radius-lg);
  --card-border-radius-large: var(--radius-md);
  --divider-radius: 1px;

  // Spacing Aliases
  --title-bar-padding: var(--space-xs);
  --banner-padding: var(--space-sm);
  --item-padding: var(--space-md);
  --container-padding: var(--space-xl);
  --header-gap: var(--space-md);
  --button-gap: var(--space-md);
  --panel-gap: var(--space-xl);
  --container-gap: var(--space-2xl);
  --modal-gap: var(--space-xl);
  --section-gap: var(--space-2xl);
  --legend-gap: var(--space-xl);

  // Padding Aliases
  --panel-padding: var(--space-xl);
  --modal-padding: var(--space-2xl);
  --content-padding: var(--space-2xl);
  --step-padding: var(--space-md);
  --button-padding: var(--space-md) 1.75rem;
  --panel-header-padding: var(--space-xl);
  --panel-content-padding: var(--space-xl) var(--space-2xl) var(--space-2xl) var(--space-2xl);
  --panel-actions-padding: var(--space-md) var(--space-xl);

  // Mobile Responsive
  --panel-padding-mobile: var(--space-md);
  --modal-padding-mobile: var(--space-xl);
  --section-gap-mobile: var(--space-lg);
  --legend-gap-mobile: var(--space-sm);

  // Layout Constants
  --titlebar-height: 74px;
  --sidebar-width: 250px;
  --status-bar-height: 48px;

  // Global UI Variables
  --text-muted: var(--dim-color);
  --bg-elevated: color-mix(in srgb, var(--window-fg-color) 3%, transparent);
  --bg-hover: var(--hover-bg-color);
  --bg-selected: var(--selected-bg-color);

  // Icon Size Scale
  --icon-size-xs: 14px;
  --icon-size-sm: 18px;
  --icon-size-md: 24px;
  --icon-size-lg: 32px;
  --icon-size-xl: 48px;
  --icon-container-size: 64px;

  // Typography Scale
  --font-size-6xl: 4rem;
  --font-size-5xl: 3.5rem;
  --font-size-4xl: 2.5rem;
  --font-size-3xl: 2rem;
  --font-size-2xl: 1.5rem;
  --font-size-xl: 1.25rem;
  --font-size-base: 1rem;
  --font-size-md: 0.875rem;
  --font-size-sm: 0.75rem;
  --font-size-xs: 0.625rem;

  // Opacity Scale
  --panel-hover-opacity: 0.1;
  --background-opacity: 0.05;
  --border-opacity: 0.05;
  --hover-opacity: 0.03;
  --active-opacity: 0.1;
  --inactive-opacity: 0.02;
  --legend-opacity: 0.15;

  // Transition Scale
  --transition-fast: all 0.2s ease;
  --transition-standard: all 0.3s ease;
  --transition-slow: all 0.5s ease;
  --transition-cubic: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);

  // Shadow Scale (authentic libadwaita - outline + subtle layered shadows)
  --shadow-gnome:
    0 0 0 1px var(--card-shade-color), 0 1px 3px 1px rgba(0, 0, 0, 0.07),
    0 2px 6px 2px rgba(0, 0, 0, 0.03);

  // Popover/menu shadow (the one exception where libadwaita uses actual shadows)
  --shadow-popover: 0 1px 5px 1px rgba(0, 0, 0, 0.09), 0 2px 14px 3px rgba(0, 0, 0, 0.05);

  // Component-specific
  --action-btn-scale-hover: 0.9;
  --action-btn-scale-disabled: 0.8;

  // Onboarding gradient
  --onboarding-background:
    radial-gradient(
      circle at 20% 50%,
      color-mix(in srgb, var(--primary-color) 50%, transparent) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 80% 20%,
      color-mix(in srgb, var(--accent-color) 50%, transparent) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 40% 80%,
      color-mix(in srgb, var(--primary-color) 50%, transparent) 0%,
      transparent 50%
    ),
    linear-gradient(
      135deg,
      color-mix(in srgb, var(--window-bg-color) 90%, transparent) 0%,
      color-mix(in srgb, var(--view-bg-color) 90%, transparent) 100%
    );

  // Headless Mode Gradient
  --headless-background:
    radial-gradient(
      circle at 20% 50%,
      color-mix(in srgb, var(--gnome-orange-3) 40%, transparent) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 80% 20%,
      color-mix(in srgb, var(--gnome-yellow-4) 40%, transparent) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 40% 80%,
      color-mix(in srgb, var(--gnome-red-3) 40%, transparent) 0%,
      transparent 50%
    ),
    linear-gradient(
      135deg,
      color-mix(in srgb, var(--window-bg-color) 90%, transparent) 0%,
      color-mix(in srgb, var(--view-bg-color) 90%, transparent) 100%
    );

  -webkit-font-smoothing: antialiased;

  mat-card-header {
    padding: var(--panel-header-padding);

    mat-card-title {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      color: var(--window-fg-color);
      font-weight: 500;
      font-size: var(--font-size-md);

      mat-icon {
        width: var(--icon-size-md);
        height: var(--icon-size-md);
        color: var(--primary-color);
      }

      .count {
        color: var(--dim-color);
        font-size: var(--font-size-base);
        font-weight: 400;
        background: rgba(var(--accent-color-rgb), var(--active-opacity));
        padding: var(--space-xxs) var(--space-xs);
        border-radius: var(--badge-radius);
        box-shadow: 0 0 0 1px rgba(var(--accent-color-rgb), 0.2);
      }
    }
  }
}

// ============================================================================
// SECTION 5: GLOBAL STYLES & MATERIAL COMPONENT OVERRIDES
// ============================================================================

body {
  margin: 0;
  font-family: system-ui, Inter, sans-serif;
  overflow: auto;
  // Standard (Firefox - no support for -webkit-scrollbar)
  @supports not selector(::-webkit-scrollbar) {
    scrollbar-width: thin;
    scrollbar-color: var(--border-color) transparent;
  }

  // Chromium & Safari (precise pixel control)
  &::-webkit-scrollbar {
    width: 4px;
    height: 4px;
  }
  &::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: var(--divider-radius);
  }
  &::-webkit-scrollbar-track {
    background: transparent;
  }

  // Headless Mode Overrides - Orange/Yellow Theme
  &.mode-headless {
    --primary-color: var(--gnome-orange-3);
    --accent-color: var(--gnome-yellow-4);
    --primary-color-rgb: 255, 120, 0;
    --accent-color-rgb: 245, 194, 17;

    // Material System Overrides
    --mat-sys-primary: var(--gnome-orange-3);
    --mat-sys-tertiary: var(--gnome-yellow-4);

    // Adjust containers
    --mat-sys-primary-container: color-mix(
      in srgb,
      var(--gnome-orange-3) 15%,
      var(--view-bg-color)
    );
    --mat-sys-on-primary-container: var(--gnome-orange-5);
  }

  @include mat.form-field-overrides(
    (
      filled-label-text-color: var(--dim-color),
      filled-input-text-color: var(--window-fg-color),
      filled-input-text-placeholder-color: var(--dim-color),
      filled-focus-label-text-color: var(--accent-color),
      filled-caret-color: var(--accent-color),
      filled-hover-label-text-color: var(--window-fg-color),
    )
  );

  .mat-mdc-form-field .mat-mdc-text-field-wrapper {
    border-radius: var(--input-border-radius);
    .mdc-line-ripple {
      display: none !important;
    }
  }

  @include mat.button-overrides(
    (
      filled-container-shape: var(--button-border-radius),
      outlined-container-shape: var(--button-border-radius),
      tonal-container-shape: var(--button-border-radius),
      text-container-shape: var(--button-border-radius),
      protected-container-shape: var(--button-border-radius),
    )
  );

  @include mat.fab-overrides(
    (
      container-shape: var(--button-border-radius),
      small-container-shape: var(--button-border-radius),
      extended-container-shape: var(--button-border-radius),
    )
  );

  @include mat.icon-button-overrides(
    (
      container-shape: var(--button-border-radius),
    )
  );

  @include mat.chips-overrides(
    (
      outline-color: var(--border-color),
      focus-outline-color: var(--border-color),
    )
  );

  @include mat.menu-overrides(
    (
      container-shape: var(--radius-sm),
      container-color: var(--popover-bg-color),
      divider-color: var(--border-color),
      divider-top-spacing: var(--space-xs),
      divider-bottom-spacing: var(--space-xs),
      item-label-text-color: var(--window-fg-color),
    )
  );

  @include mat.card-overrides(
    (
      // Container styling - use libadwaita colors
      elevated-container-color: var(--view-bg-color),
      filled-container-color: var(--view-bg-color),
      outlined-container-color: var(--view-bg-color),
      // Border radius
      elevated-container-shape: var(--card-border-radius),
      filled-container-shape: var(--card-border-radius),
      outlined-container-shape: var(--card-border-radius),
      elevated-container-elevation: var(--shadow-gnome)
    )
  );

  @include mat.expansion-overrides(
    (
      container-shape: var(--card-border-radius),
      // Use libadwaita-style outline shadow instead of heavy drop shadow
      container-elevation-shadow: var(--shadow-gnome),
    )
  );
}

* {
  user-select: none;
  transition:
    background 0.5s ease,
    background-color 0.5s ease,
    color 0.05s ease;
  -webkit-user-drag: none;
}

pre,
code,
input,
textarea,
[contenteditable='true'] {
  user-select: text;
  cursor: text;

  span {
    user-select: text;
    cursor: text;
  }
}

// Fix for mat-icon overflow issues in Windows
mat-icon {
  overflow: visible !important;
  min-height: unset !important;
  flex-shrink: 0;

  &.warn {
    color: var(--warn-color) !important;
  }

  &.primary {
    color: var(--primary-color) !important;
  }

  &.accent {
    color: var(--accent-color) !important;
  }

  &.orange {
    color: var(--orange) !important;
  }

  &.purple {
    color: var(--purple) !important;
  }

  &.yellow {
    color: var(--yellow) !important;
  }
}

button {
  display: flex;
  border: none;
  flex-direction: row !important;
  background-color: transparent;
  align-items: center;
  justify-content: center;

  span {
    display: flex;
    flex-direction: row !important;
    gap: var(--space-xs);
    white-space: nowrap;
  }

  &.primary {
    color: white !important;
    background: var(--primary-color) !important;
  }

  &.accent {
    color: white !important;
    background: var(--accent-color) !important;
  }

  &.warn {
    color: white !important;
    background: var(--warn-color) !important;
  }

  &.yellow {
    color: white !important;
    background: var(--yellow) !important;
  }

  &.purple {
    color: white !important;
    background: var(--purple) !important;
  }

  &.orange {
    color: white !important;
    background: var(--orange) !important;
  }

  &:disabled {
    background: color-mix(in srgb, var(--dim-color) 30%, transparent) !important;
    color: color-mix(in srgb, var(--window-fg-color) 50%, transparent) !important;
    transform: none !important;
    box-shadow: none !important;
  }
}

.cdk-overlay-pane,
.cdk-overlay-dark-backdrop {
  border-radius: var(--app-border-radius) !important;
}

.mat-bottom-sheet-container {
  box-shadow: none !important;
  border-radius: var(--radius-md) var(--radius-md) 0 0 !important;

  @media (max-width: 960px) {
    border-radius: var(--app-border-radius) !important;
  }
}

// Form fields
.mat-mdc-form-field {
  width: 100%;
}

.mat-mdc-dialog-container .mdc-dialog__surface {
  border-radius: var(--modal-radius) !important;

  @media (max-width: 450px) {
    border-radius: var(--modal-radius) var(--modal-radius) var(--app-border-radius)
      var(--app-border-radius) !important;
  }
}

// ============================================================================
// RESPONSIVE MODAL → BOTTOM SHEET BEHAVIOR (Libadwaita Style)
// ============================================================================
// On narrow viewports (≤450px), modals transform into bottom sheets that slide
// up from the bottom of the screen, matching GNOME's adaptive dialog behavior.
@media (max-width: 450px) {
  .cdk-overlay-pane.mat-mdc-dialog-panel {
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    // This is the real behavior of libadwaita but my modals has a dynamic height.
    // So this not looks good on my side. I gonna use the static height.
    // height: auto !important;
    // max-height: 96vh !important;
    height: 96vh !important;
    margin: 0 !important;
  }

  mat-dialog-container.mat-mdc-dialog-container,
  .mat-mdc-dialog-container.mdc-dialog {
    // Apply our custom slide-up animation
    animation: slideUpSheet 250ms cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;

    // Closing animation - triggered by adding 'closing' class via ModalService.animatedClose()
    &.closing {
      animation: slideDownSheet 200ms cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards !important;
    }
  }
}

// ============================================================================
// SECTION 6: COMPONENT STYLES
// ============================================================================

@media (max-width: 540px) {
  mat-accordion {
    gap: var(--space-sm);
  }

  .mat-expansion-panel-header {
    padding: var(--space-sm);
    min-height: 56px;
  }

  mat-panel-title {
    gap: var(--space-sm);

    mat-icon:first-child {
      font-size: 20px;
      width: 20px;
      height: 20px;
    }
  }
}

mat-accordion {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.mat-expansion-panel {
  background: var(--view-bg-color) !important;
  border-radius: var(--card-border-radius) !important;

  .mat-expansion-panel-body {
    padding: var(--space-md);
  }

  mat-panel-title {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    flex: 1;

    mat-icon:first-child {
      color: var(--primary-color);
      opacity: 0.9;
    }
  }

  mat-panel-description {
    flex-grow: 0;
    flex-basis: auto;
  }

  .mat-expansion-panel-header {
    min-height: 72px;
  }

  .mat-expansion-panel-header-description {
    justify-content: flex-end;
    align-items: center;
    display: flex;
    gap: 12px;
    font-size: clamp(12px, 2vw, 14px);
    font-weight: 500;
  }
}

// Dropdown option content styling
.option-content {
  display: flex;
  flex-direction: column;
  gap: var(--space-xxs);
  padding: var(--space-xs) 0;

  .option-label {
    color: var(--window-fg-color);
    font-weight: 500;
    font-size: var(--font-size-base);
  }

  .option-description {
    color: var(--text-muted);
    font-size: var(--font-size-sm);
  }
}

// Custom context menu
.material-context-menu {
  display: flex;
  flex-direction: column;
  gap: var(--space-xxs);
  min-width: 200px;
  max-width: 300px;
  max-height: 400px;
  overflow-y: auto;

  background: var(--popover-bg-color);
  color: var(--window-fg-color);
  border-radius: var(--radius-sm);
  padding: 6px;
  box-shadow: var(--shadow-popover);

  .menu-item {
    all: unset;
    display: flex;
    align-items: center;
    gap: var(--space-xxs);
    box-sizing: border-box;
    overflow: hidden;
    text-overflow: ellipsis;

    width: 100%;
    min-height: 34px;
    padding: var(--space-xxs) var(--space-sm);

    font-size: var(--font-size-md);
    font-family: inherit;
    font-weight: 500;
    color: var(--window-fg-color);

    border-radius: var(--radius-xs);
    transition: var(--transition-instant);

    &:hover,
    &:focus,
    &:focus-visible {
      background-color: var(--hover-bg-color);
      outline: none;
    }

    &:active {
      background-color: var(--active-bg-color);
    }

    &:disabled {
      opacity: 0.4;
      background: transparent;
    }
  }
}

.empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-lg) var(--space-md);
  text-align: center;
  gap: var(--space-sm);
  color: var(--dim-color);

  mat-icon {
    width: 48px;
    height: 48px;
    opacity: 0.4;
  }

  span {
    font-size: var(--font-size-base);
    font-weight: 500;
  }

  p {
    font-size: var(--font-size-sm);
    opacity: 0.8;
    margin-block: var(--space-xxs);
  }
}

// ============================================================================
// SECTION 6: MARKDOWN STYLING
// ============================================================================
// Reusable styles for rendering markdown content to match the application theme.
// Mimics VS Code's markdown preview.

.markdown-body {
  // VS Code-like Markdown Styling
  font-family: 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  line-height: 1.6;
  word-wrap: break-word;
  color: var(--window-fg-color);

  .heading-anchor {
    opacity: 0;
    margin-right: 0.4em;
    font-size: 0.85em;
    transition: var(--transition-fast);
    &:hover {
      opacity: 1 !important;
    }
  }

  // Headings
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
    color: var(--window-fg-color);
    scroll-margin-top: 90px;

    &:hover .heading-anchor {
      opacity: 1;
    }
  }

  h1 {
    font-size: 2em;
    padding-bottom: 0.3em;
    border-bottom: 1px solid rgba(var(--window-fg-color-rgb), 0.2);
  }

  h2 {
    font-size: 1.5em;
    padding-bottom: 0.3em;
    border-bottom: 1px solid rgba(var(--window-fg-color-rgb), 0.1);
  }

  h3 {
    font-size: 1.25em;
  }

  h4 {
    font-size: 1em;
  }

  // Paragraphs & Lists
  p,
  ul,
  ol {
    margin-top: 0;
    margin-bottom: 16px;
  }

  li {
    margin: 4px 0;
    > p {
      margin-top: 16px;
    }
  }

  ul {
    list-style-type: disc;
    padding-left: 2em;
  }

  ol {
    list-style-type: decimal;
    padding-left: 2em;
  }

  // Links
  a {
    color: var(--accent-color);
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }

  // Emphasis
  strong {
    font-weight: 600;
    color: var(--window-fg-color);
  }

  em {
    font-style: italic;
    color: var(--dim-color);
  }

  // Code
  code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    background-color: rgba(var(--window-fg-color-rgb), 0.1);
    border-radius: 6px;
  }

  pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: rgba(var(--window-fg-color-rgb), 0.05);
    border-radius: 6px;
    margin-top: 0;
    margin-bottom: 16px;

    code {
      padding: 0;
      margin: 0;
      font-size: 100%;
      word-break: normal;
      white-space: pre;
      background: transparent;
      border: 0;
      color: var(--window-fg-color);
    }

    button {
      position: absolute;
      top: var(--space-xs);
      right: var(--space-xs);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      padding: 0;
      background: rgba(255, 255, 255, 0.06);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.12);
      border-radius: var(--radius-xs);
      cursor: pointer;
      user-select: none;
      transition:
        opacity 0.15s,
        background 0.15s,
        color 0.15s;
      color: var(--dim-color);

      span {
        font-size: 1rem;
        width: 1rem;
        height: 1rem;
      }

      &:hover {
        background: rgba(255, 255, 255, 0.12);
        color: var(--window-fg-color);
      }

      &.copied {
        color: var(--primary-color);
        box-shadow: 0 0 0 1px var(--primary-color);
        background: rgba(var(--primary-color-rgb), 0.12);
      }
    }
  }

  // Blockquotes
  blockquote {
    padding: 0 1em;
    color: var(--dim-color);
    border-left: 0.25em solid rgba(var(--window-fg-color-rgb), 0.2);
    margin-top: 0;
    margin-bottom: 16px;
    background: rgba(var(--window-fg-color-rgb), 0.02);
    padding-block: 8px;

    > :first-child {
      margin-top: 0;
    }
    > :last-child {
      margin-bottom: 0;
    }
  }

  // Horizontal Rule
  hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: rgba(var(--window-fg-color-rgb), 0.2);
    border: 0;
  }

  // Tables
  table {
    border-spacing: 0;
    border-collapse: collapse;
    margin-top: 0;
    margin-bottom: 16px;
    width: max-content;
    max-width: 100%;
    overflow: auto;
    display: block; // Allows scrolling for wide tables

    th,
    td {
      padding: 6px 13px;
      box-shadow: 0 0 0 1px rgba(var(--window-fg-color-rgb), 0.2);
    }

    th {
      font-weight: 600;
      background-color: rgba(var(--window-fg-color-rgb), 0.1);
    }

    tr {
      background-color: transparent;
      border-top: 1px solid rgba(var(--window-fg-color-rgb), 0.1);

      &:nth-child(2n) {
        background-color: rgba(var(--window-fg-color-rgb), 0.03);
      }
    }
  }

  // Images
  img {
    max-width: 100%;
    box-sizing: border-box;
    background-color: transparent;
    margin: 16px 0;
    border-radius: 4px;
    display: block;
    height: auto;
    margin: var(--space-md) auto;
  }

  // Task Lists
  ul.contains-task-list {
    list-style-type: none;
    padding-left: 0;
  }

  .task-list-item {
    display: flex;
    align-items: flex-start;
    gap: 8px;

    input[type='checkbox'] {
      margin-top: 0.3em;
    }
  }

  // Inline Material Icons from custom [[icon:name]] syntax
  .md-icon {
    font-family: 'Material Icons';
    font-weight: normal;
    font-style: normal;
    font-size: 1.25em;
    line-height: 1;
    letter-spacing: normal;
    text-transform: none;
    display: inline-block;
    white-space: nowrap;
    word-wrap: normal;
    direction: ltr;
    -webkit-font-feature-settings: 'liga';
    font-feature-settings: 'liga';
    -webkit-font-smoothing: antialiased;
    vertical-align: middle;
    margin-top: -2px;
    margin-right: 4px;

    &.primary {
      color: var(--primary-color);
    }
    &.accent {
      color: var(--accent-color);
    }
    &.warn {
      color: var(--warn-color);
    }
    &.success {
      color: var(--gnome-green-4);
    }
  }
}

// ============================================================================
// GLOBAL LAYOUT UTILITIES
// ============================================================================

.page-container {
  width: 100%;
  margin: 0 auto;
  padding: 2rem;
  box-sizing: border-box;

  // Ensure content doesn't touch edges on small screens
  @media (max-width: 768px) {
    padding: 1rem;
  }
}

.page-header {
  text-align: center;
  margin-bottom: 3rem;

  h1 {
    font-size: var(--font-size-4xl);
    font-weight: 700;
    margin: 0 0 1rem 0;
    color: var(--window-fg-color);

    @media (max-width: 768px) {
      font-size: var(--font-size-3xl);
    }
  }

  p {
    font-size: 1.125rem;
    color: var(--text-muted);
    margin: 0 auto;
    max-width: 600px;
    line-height: 1.6;
  }
}

// Global Section Styles
.section-title {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 0.75rem;
  font-size: var(--font-size-xl);
  font-weight: 700;
  margin: 0 0 var(--space-md) 0;
  color: var(--window-fg-color);
  text-align: left;

  mat-icon {
    color: var(--primary-color);
    width: 32px;
    height: 32px;
    font-size: 32px;
  }

  @media (max-width: 768px) {
    font-size: 1.75rem;
    flex-direction: column;
    gap: 0.5rem;
  }
}

.section-subtitle {
  font-size: var(--font-size-md);
  color: var(--text-muted);
  margin: 0 0 var(--space-lg) 0;
}

// Global Bottom Sheet override for themed background
.docs-nav-sheet-panel {
  .mat-bottom-sheet-container {
    padding: 0 !important;
  }
}
