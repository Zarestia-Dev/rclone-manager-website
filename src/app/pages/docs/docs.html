<div class="page-container animate-fade-in">
  <div class="docs-detail-layout">
    <!-- Sidebar Navigation -->
    <aside class="docs-sidebar animate-fade-in-right">
      <div class="sidebar-search">
        <mat-icon>search</mat-icon>
        <input type="text" placeholder="Search documentation..." [value]="searchQuery()"
          (input)="onSearch($any($event.target).value)" aria-label="Search documentation">
        @if (isIndexing()) {
          <mat-spinner diameter="16" class="search-spinner"></mat-spinner>
        }

        <!-- Advanced Search Results Overlay -->
        @if (searchQuery().length >= 2) {
          <div class="search-results-overlay animate-fade-in-up">
            <div class="results-header">
              <span>{{ searchHits().length }} Results Found</span>
              <button mat-icon-button (click)="onSearch('')"><mat-icon>close</mat-icon></button>
            </div>
            
            <div class="results-list">
              @for (hit of searchHits(); track hit.item.title) {
                <div class="search-hit" (click)="selectItem(hit.item, searchQuery())" 
                  (keydown.enter)="selectItem(hit.item, searchQuery())"
                  tabindex="0" role="button" aria-label="Navigate to search result">
                  <div class="hit-meta">
                    <mat-icon>{{ hit.item.icon || 'description' }}</mat-icon>
                    <span class="hit-section">{{ hit.sectionTitle }}</span>
                  </div>
                  <div class="hit-title">{{ hit.item.title }}</div>
                  <div class="hit-snippet" [innerHTML]="hit.snippet"></div>
                </div>
              } @empty {
                <div class="no-results">No matches found for "{{ searchQuery() }}"</div>
              }
            </div>
          </div>
        }
      </div>

      <div class="sidebar-sections">
        @for (section of docSections(); track section.title) {
        <div class="sidebar-section">
          <h3 class="sidebar-section-title">{{ section.title }}</h3>
          <div class="sidebar-items">
            @for (item of section.items; track item.title) {
            <button mat-button class="sidebar-item" [class.active]="selectedItem()?.title === item.title"
              (click)="selectItem(item)" [matTooltip]="item.description || ''" matTooltipPosition="right">
              <mat-icon class="main-icon">{{ item.icon || 'description' }}</mat-icon>
              <span class="item-title">{{ item.title }}</span>
              @if (item.isExternal) {
              <mat-icon class="external-icon">open_in_new</mat-icon>
              }
            </button>
            }
          </div>
        </div>
        }

        <div class="sidebar-section">
          <h3 class="sidebar-section-title">Quick Links</h3>
          <div class="sidebar-items">
            @for (link of quickLinks(); track link.title) {
            <button mat-button class="sidebar-item" (click)="openExternalLink(link.url)">
              <mat-icon class="main-icon">{{ link.icon }}</mat-icon>
              <span class="item-title">{{ link.title }}</span>
              <mat-icon class="external-icon">open_in_new</mat-icon>
            </button>
            }
          </div>
        </div>
      </div>
    </aside>

    <!-- Content Area -->
    <div class="docs-content-wrapper">
      <div class="docs-content-card animate-fade-in-up">
        @if (loading()) {
        <div class="loading-overlay">
          <mat-spinner diameter="48"></mat-spinner>
          <p>Loading Documentation...</p>
        </div>
        }

        @if (selectedItem()) {
          <article class="markdown-body" [innerHTML]="renderedContent()" #contentArea></article>

          <mat-divider></mat-divider>

          <div class="docs-footer">
            <p>Found a mistake? Help us improve the docs!</p>
            <button mat-stroked-button
              (click)="openExternalLink('https://github.com/Zarestia-Dev/rclone-manager-website/edit/master/public/docs/' + selectedItem()?.assetPath)">
              <mat-icon>edit</mat-icon>
              Edit this page on GitHub
            </button>
          </div>
        } @else {
          <div class="empty-state">
            <mat-icon>description</mat-icon>
            <p>Select a topic to start reading</p>
          </div>
        }
      </div>
    </div>
  </div>
</div>