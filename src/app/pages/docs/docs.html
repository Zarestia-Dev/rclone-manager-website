<div class="page-container animate-fade-in">
  <div class="docs-detail-layout">
    <!-- Sidebar Navigation -->
    <aside class="docs-sidebar animate-fade-in-right" [class.hidden]="isMobile()">

      <!-- Search -->
      <div class="sidebar-search-wrap">
        <div class="sidebar-search">
          <mat-icon>search</mat-icon>
          <input type="text" placeholder="Search docs..." [value]="docService.searchQuery()"
            (input)="onSearch($any($event.target).value)" (focus)="isSearchFocused.set(true)" (blur)="onSearchBlur()"
            (keydown)="onSearchKeydown($event)" (keydown.escape)="docService.searchQuery.set('')"
            aria-label="Search documentation">
          @if (isIndexing()) {
          <mat-spinner diameter="14" class="search-spinner"></mat-spinner>
          }
        </div>

        <!-- Results overlay â€” sibling not child, avoids height clip -->
        @if (docService.searchQuery().length >= 2 && isSearchFocused()) {
        <div class="search-results-overlay animate-fade-in-up">
          <div class="results-header">
            <span>{{ docService.searchHits().length }} Result{{ docService.searchHits().length !== 1 ? 's' : ''
              }}</span>
          </div>
          <div class="results-list">
            @for (hit of docService.searchHits(); track hit.item.title; let i = $index) {
            <div class="search-hit" [class.focused]="searchFocusIndex() === i"
              (click)="selectItem(hit.item, docService.searchQuery())"
              (keydown.enter)="selectItem(hit.item, docService.searchQuery())" tabindex="0" role="button">
              <div class="hit-meta">
                <mat-icon>{{ hit.item.icon || 'description' }}</mat-icon>
                <span class="hit-section">{{ hit.sectionTitle }}</span>
              </div>
              <div class="hit-title">{{ hit.item.title }}</div>
              <div class="hit-snippet" [innerHTML]="hit.snippet"></div>
            </div>
            } @empty {
            <div class="no-results">
              @if (isIndexing()) {
              <div class="indexing-feedback">
                <mat-spinner diameter="24"></mat-spinner>
                <p>Updating search index...</p>
              </div>
              } @else {
              No matches for "{{ docService.searchQuery() }}"
              }
            </div>
            }
          </div>
        </div>
        }
      </div>

      <div class="sidebar-sections">
        @for (section of docSections(); track section.title) {
        <div class="sidebar-section">
          <h3 class="sidebar-section-title">{{ section.title }}</h3>
          <div class="sidebar-items">
            @for (item of section.items; track item.title) {
            <button mat-button class="sidebar-item" [class.active]="selectedItem()?.title === item.title"
              (click)="selectItem(item)" [matTooltip]="item.description || ''" matTooltipPosition="right">
              <span class="button-content">
                <mat-icon class="main-icon">{{ item.icon || 'description' }}</mat-icon>
                <span class="item-title">{{ item.title }}</span>
                @if (item.isExternal) {
                <mat-icon class="external-icon">open_in_new</mat-icon>
                }
              </span>
            </button>
            }
          </div>
        </div>
        }

        <div class="sidebar-section">
          <h3 class="sidebar-section-title">Quick Links</h3>
          <div class="sidebar-items">
            @for (link of quickLinks(); track link.title) {
            <button mat-button class="sidebar-item" (click)="openExternalLink(link.url)">
              <mat-icon class="main-icon">{{ link.icon }}</mat-icon>
              <span class="item-title">{{ link.title }}</span>
              <mat-icon class="external-icon">open_in_new</mat-icon>
            </button>
            }
          </div>
        </div>
      </div>
    </aside>

    <!-- Content Area -->
    <div class="docs-content-wrapper">
      <div class="docs-content-main">
        <div class="docs-content-card animate-fade-in-up">
          @if (loading()) {
          <div class="loading-overlay">
            <mat-spinner diameter="48"></mat-spinner>
            <p>Loading Documentation...</p>
          </div>
          }

          @if (selectedItem()) {
          <article class="markdown-body" [innerHTML]="renderedContent()" #contentArea></article>

          <mat-divider></mat-divider>

          <div class="docs-footer">
            <p>Found a mistake? Help us improve the docs!</p>
            <button mat-stroked-button
              (click)="openExternalLink('https://github.com/Zarestia-Dev/rclone-manager-website/blob/main/public/docs/' + selectedItem()?.assetPath)">
              <mat-icon>edit</mat-icon>
              Edit this page on GitHub
            </button>
          </div>
          } @else {
          <div class="empty-state">
            <mat-icon>description</mat-icon>
            <p>Select a topic to start reading</p>
          </div>
          }
        </div>
      </div>

      <!-- Right Side Table of Contents -->
      @if (toc().length > 0) {
      <aside class="docs-toc-container animate-fade-in-left" [class.hidden]="!isWide()">
        <div class="toc-card">
          <h4 class="toc-title">
            <mat-icon>list</mat-icon>
            On this page
          </h4>
          <nav class="toc-nav">
            @for (link of toc(); track link.id) {
            <a href="javascript:void(0)" class="toc-link" [class.sub-item]="link.level > 2"
              [class.active]="activeTocId() === link.id" (click)="scrollToSection(link.id, $event)">
              {{ link.text }}
            </a>
            }
          </nav>
        </div>
      </aside>
      }
    </div>
  </div>

  <button mat-fab class="docs-mobile-fab" (click)="openNavSheet()" aria-label="Open documentation menu">
    <mat-icon>menu_book</mat-icon>
  </button>
</div>